# 面向对象的思想写好并发程序
<img width="800" src="https://boonlean15.github.io/cheneyBlog/images/javaconcurrent/how-to-code/1.png" alt="png">
面向对象思想和并发编程并无直接联系，但在java语言里，面向对象思想和并发编程被融合到了一起。在java语言中，面向对象思想能让并发编程变得更加简单

## 封装共享变量
并发程序的一个核心问题，解决多线程访问共享变量的并发问题。类比球场检票，座位即共享变量、入口即公共访问方法、检票即并发访问策略、
- 利用面向对象的思想写并发程序
> **将共享变量作为对象属性封装在内部，对外提供公共访问方法，所有的公共访问方法制定并发访问策略**
- 现实中，共享变量有很多个，而对于不会变化的共享变量，建议使用final关键字修饰。既避免并发访问问题，也表明了设计意图
```java
public class Counter {
  private long value;
  synchronized long get(){
    return value;
  }
  synchronized long addOne(){
    return ++value;
  }
}
```

## 识别共享变量间的约束条件
当代码里出现if语句时，要注意是否存在竞态条件。
> 库存上限和下限的共享变量例子。根据例子可以得出，如果没有充分识别共享变量之间的条件，制定出来的并发访问策略可能南辕北辙

## 制定并发访问策略
### 三个方案
- 避免共享：线程本地存储方案，以及为每个任务分配独立的线程
- 不变模式：java使用的少，其他使用的多，如Actor，CSP，函数式编程的基础都是不变模式
- 管程及其他同步工具类：java领域的万能钥匙是管程，对于很多特定场景，使用java sdk并发包下的读写锁，并发容器等同步工具更好
### 三个原则
- 优先使用成熟的工具类：sdk并发包提供了丰富的工具类，基本能满足日常使用。并发工具类不是随便就能发明的
- 迫不得已才使用低级的并发原语：synchronized、lock、semaphore，虽然感觉简单，实际并不简单
- 避免过早优化：安全第一，先保证线程安全，当出现性能问题时，再进行优化。避免杞人忧天，事倍功半

## 总结
而对共享变量进行封装，要避免“逸出”，所谓“逸出”简单讲就是共享变量逃逸到对象的外面




