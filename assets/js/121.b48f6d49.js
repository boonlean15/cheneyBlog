(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{431:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"常用统计和其他sql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用统计和其他sql"}},[t._v("#")]),t._v(" 常用统计和其他sql")]),t._v(" "),s("h2",{attrs:{id:"postgresql去除完全相同的数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postgresql去除完全相同的数据"}},[t._v("#")]),t._v(" Postgresql去除完全相同的数据")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/642309567?utm_id=0",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考Postgresql 如何去除完全相同的数据"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[t._v("去重思路")])]),t._v(" "),s("blockquote",[s("p",[t._v("主要的思路是找到字段的唯一条件，根据字段取出掉重复记录。Postgresql的去重是通过 ctid 完成的。注意本文针对的是 单表 的数据库数据去重处理。")]),t._v(" "),s("p",[t._v("ctid 是什么？ ctid： 表示数据记录的物理行当信息，指的是 一条记录位于哪个数据块的哪个位移上面。")])]),t._v(" "),s("ul",[s("li",[t._v("数据查看"),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" ctid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("重复数据查询"),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("distinct")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("having")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("保留需要的数据"),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" ctid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" ctid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ctid\tid\tname\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\tdavid\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\tsandy\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\trenee\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\tjack\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\trose\n")])])])]),t._v(" "),s("li",[t._v("删除重复数据"),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" ctid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("查看最后结果"),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" ctid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ctid\tid\tname\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\tdavid\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\tsandy\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\trenee\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\tjack\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\trose\n")])])])])]),t._v(" "),s("p",[s("strong",[t._v("关于Postgresql去重的小技巧，不同数据库实现细节不同，但是多数的思路是类似的")])]),t._v(" "),s("h3",{attrs:{id:"数据库字段做了脱敏处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库字段做了脱敏处理"}},[t._v("#")]),t._v(" 数据库字段做了脱敏处理：")]),t._v(" "),s("ul",[s("li",[t._v("通过查询找出当前表的重复记录")]),t._v(" "),s("li",[t._v("删除重复数据（PS：如果重复数据是海量数据，需要使用 limit 配合 for 循环进行多次处理，不允许一次性大批量删除数据）")]),t._v(" "),s("li",[t._v("检查去重之后的结果")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("begin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 通过查询找出当前表的重复记录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" ctid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" results "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" ctid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" results  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BANK1'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" trade_numeber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BANK1'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" trade_numeber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 删除重复数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 如果这里有海量数据，需要使用limit配合for循环进行多次处理，不允许一次性大批量删除数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" results "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" ctid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" results  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BANK1'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" trade_numeber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BANK1'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" trade_numeber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 检查去重之后的结果")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" results "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BANK1'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"数据备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据备份"}},[t._v("#")]),t._v(" 数据备份")]),t._v(" "),s("h3",{attrs:{id:"备份单表数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份单表数据"}},[t._v("#")]),t._v(" 备份单表数据")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" postgres pg_dump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" order  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" order.sql\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" postgres pg_dump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" change_list "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" change_list.sql\n")])])]),s("h3",{attrs:{id:"备份数据库结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份数据库结构"}},[t._v("#")]),t._v(" 备份数据库结构")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" postgres pg_dump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" database  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" schema_full.sql\n")])])]),s("h2",{attrs:{id:"数据空间清理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据空间清理"}},[t._v("#")]),t._v(" 数据空间清理")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 删除十天前数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" create_time "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2024-10-14 10:38:23'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interval")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10 days'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 使用psql命令行工具，您可以直接运行上面的SQL命令")]),t._v("\npsql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d your_database "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"DELETE FROM your_table WHERE date_column < now() - interval '10 days';\"")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 看这个表的状态信息 n_live_tup          | 12674745   #表示当前表的数据量，n_dead_tup          | 37325572   #表示为回收的空间")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pg_stat_user_tables "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" relname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'table_name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" pg_size_pretty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_relation_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'table_name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nVACUUM "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FULL")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 释放特定表的空间")]),t._v("\nVACUUM "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" VERBOSE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ANALYZE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 或者，对整个数据库执行VACUUM")]),t._v("\nVACUUM "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" VERBOSE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ANALYZE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"pg查看表结构信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pg查看表结构信息"}},[t._v("#")]),t._v(" pg查看表结构信息")]),t._v(" "),s("ul",[s("li",[t._v("通过命令行查询")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("d 数据库 —— 得到所有表的名字\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("d 表名 —— 得到表结构\n")])])]),s("ul",[s("li",[t._v("通过SQL语句查询")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"select * from pg_tables"')]),t._v(" —— 得到当前db中所有表的信息\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"select tablename from pg_tables where schemaname='public'\"")]),t._v(" —— 得到所有用户自定义表的名字\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tablename"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" from pg_tables where "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("schemaname")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'public'")]),t._v(" --- 得到用户自定义表数量\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "tablename"字段是表的名字 "schemaname"是schema的名字 用户自定义的表，如果未经特殊处理，默认都是放在名为public的schema下')]),t._v("\n")])])]),s("h2",{attrs:{id:"统计大小"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统计大小"}},[t._v("#")]),t._v(" 统计大小")]),t._v(" "),s("ul",[s("li",[t._v("统计数据库大小")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("单个数据库的大小\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" datname, pg_size_pretty "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_database_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("datname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" AS size from pg_database where datname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n所有数据库的大小\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" datname, pg_size_pretty "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_database_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("datname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" AS size from pg_database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("统计数据表大小")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("单个表大小\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" pg_size_pretty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_relation_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("‘mytab’"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" as size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n查询单个表的总大小，包括该表的索引大小\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" pg_size_pretty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_total_relation_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("‘tab’"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" as size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n所有表大小\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" relname, pg_size_pretty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_relation_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("relid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" from pg_stat_user_tables order by pg_relation_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("relid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" desc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("查询单个表的数据大小，索引大小，表大小，并按表大小倒序排列")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n    table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pg_size_pretty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" table_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pg_size_pretty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("indexes_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" indexes_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pg_size_pretty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("total_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" total_size\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n        table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        pg_table_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" table_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        pg_indexes_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" indexes_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        pg_total_relation_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" total_size\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" table_schema "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\".\"'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" table_name\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" information_schema"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tables")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" all_tables\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" total_size "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DESC")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" pretty_sizes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("所有表的记录数")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" relname as TABLE_NAME, reltuples as rowCounts from pg_class where relkind "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'r'")]),t._v(" order by rowCounts desc\n")])])]),s("ul",[s("li",[t._v("查询数据库及大小")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" pg_database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pg_size_pretty "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_database_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" size "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pg_database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("参考")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/liqiu/p/3922288.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("POSTGRESQL 查看数据库 数据表大小"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/telwanggs/p/13645310.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgreSQL 查询所有数据库大小，表大小，索引大小，以及表空间大小"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/leo_qi/article/details/84804644",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgreSQL查询出所有表的记录数"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/DB_su/article/details/77935740",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgreSQL Daily Maintenance - reindex"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/592895865",target:"_blank",rel:"noopener noreferrer"}},[t._v("Postgresql 删除大量数据优化表空间"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.alibabacloud.com/help/zh/apsaradb-for-rds/latest/solutions-to-sharp-increase-in-disk-space-usage-in-postgresql-or-ppas-databases",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgreSQL数据库磁盘空间占用剧增后的解决方法"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"查询数据库空间-mysql和oracle"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询数据库空间-mysql和oracle"}},[t._v("#")]),t._v(" 查询数据库空间(mysql和oracle)")]),t._v(" "),s("h3",{attrs:{id:"mysql版"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql版"}},[t._v("#")]),t._v(" Mysql版")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("查看所有数据库容量大小\n-- 查看所有数据库容量大小\nSELECT\n    table_schema AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据库'")]),t._v(",\n    sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" table_rows "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'记录数'")]),t._v(",\n    sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    TRUNCATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" data_length / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据容量(MB)'")]),t._v(",\n    sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    TRUNCATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" index_length / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'索引容量(MB)'")]),t._v(" \nFROM\n    information_schema.TABLES \nGROUP BY\n    table_schema \nORDER BY\n    sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" data_length "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" DESC,\n    sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" index_length "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" DESC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n查看所有数据库各表容量大小\nSELECT\n    table_schema AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据库'")]),t._v(",\n    table_name AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'表名'")]),t._v(",\n    table_rows AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'记录数'")]),t._v(",\n    TRUNCATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" data_length / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据容量(MB)'")]),t._v(",\n    TRUNCATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" index_length / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'索引容量(MB)'")]),t._v(" \nFROM\n    information_schema.TABLES \nORDER BY\n    data_length DESC,\n    index_length DESC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n查看指定数据库容量大小\nSELECT\n    table_schema AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据库'")]),t._v(",\n    sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" table_rows "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'记录数'")]),t._v(",\n    sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    TRUNCATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" data_length / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据容量(MB)'")]),t._v(",\n    sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    TRUNCATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" index_length / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'索引容量(MB)'")]),t._v(" \nFROM\n    information_schema.TABLES \nWHERE\n    table_schema "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据库名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n查看指定数据库各表容量大小\nSELECT\n    table_schema AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据库'")]),t._v(",\n    table_name AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'表名'")]),t._v(",\n    table_rows AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'记录数'")]),t._v(",\n    TRUNCATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" data_length / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据容量(MB)'")]),t._v(",\n    TRUNCATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" index_length / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" AS "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'索引容量(MB)'")]),t._v(" \nFROM\n    information_schema.TABLES \nWHERE\n    table_schema "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据库名'")]),t._v(" \nORDER BY\n    data_length DESC,\n    index_length DESC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n查看指定数据库各表信息\nSHOW TABLE STATUS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"oracle版"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#oracle版"}},[t._v("#")]),t._v(" oracle版")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("查看表所占的空间大小\n--  不需要DBA权限\nSELECT SEGMENT_NAME TABLENAME,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BYTES/1024/1024"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" MB\n,RANK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" OVER "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("PARTITION BY NULL ORDER BY BYTES DESC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" RANK_ID  //根据表大小进行排序\nFROM USER_SEGMENTS\nWHERE "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SEGMENT_TYPE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE'")]),t._v("\n\n-- 需要DBA权限,一般情况下很少会给这么高的权限,可以说这个权限基本没有,所以一般工作中不是DBA的人不会常用到这个命令\nSELECT t.tablespace_name, round"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SUM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ts_size \nFROM dba_tablespaces t, dba_data_files d \nWHERE t.tablespace_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d.tablespace_name \nGROUP BY t.tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n \n\n查看表空间的使用情况\nSELECT a.tablespace_name "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"表空间名称"')]),t._v(",\n       total / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"表空间大小(M)"')]),t._v(",\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"表空间剩余大小(M)"')]),t._v(",\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("total - "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"表空间使用大小(M)"')]),t._v(",\n       total / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"表空间大小(G)"')]),t._v(",\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"表空间剩余大小(G)"')]),t._v(",\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("total - "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" * "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"表空间使用大小(G)"')]),t._v(",\n       round"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),t._v("total "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" free"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" total"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(' "使用率 '),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v('"\nFROM '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SELECT tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SUM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" free\n      FROM dba_free_space\n      GROUP BY tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SELECT tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SUM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" total\n      FROM dba_data_files\n      GROUP BY tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" b\nWHERE a.tablespace_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b.tablespace_name\n\n查看回滚段名称及大小\nSELECT segment_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \ntablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \nr.status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initial_extent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" initialextent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next_extent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" nextextent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \nmax_extents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \nv.curext curextent \nFROM dba_rollback_segs r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v$rollstat v \nWHERE r.segment_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" v.usn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \nORDER BY segment_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n查看控制文件\nSELECT NAME FROM v$controlfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n查看日志文件\nSELECT MEMBER FROM v$logfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n查看数据库对象\nSELECT owner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" object_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" COUNT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" count# \nFROM all_objects \nGROUP BY owner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" object_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n查看数据库版本\nSELECT version \nFROM product_component_version \nWHERE substr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 'Oracle'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n查看数据库的创建日期和归档方式\nSELECT created"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" log_mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" log_mode FROM v$database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n查看表空间是否具有自动扩展的能力\nSELECT T.TABLESPACE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("D.FILE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nD.AUTOEXTENSIBLE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("D.BYTES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("D.MAXBYTES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("D.STATUS\nFROM DBA_TABLESPACES T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("DBA_DATA_FILES D\nWHERE T.TABLESPACE_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("D.TABLESPACE_NAME\n ORDER BY TABLESPACE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("FILE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\noracle加强版\n一、查看表空间使用率\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v("查看数据库表空间文件"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("查看数据库表空间文件\nselect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" from dba_data_files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("查看所有表空间的总容量\nselect dba.TABLESPACE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" as MB  \nfrom dba_data_files dba \ngroup by dba.TABLESPACE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("查看数据库表空间使用率\nselect total.tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("round"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("total.MB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" as Total_MB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("round"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("total.MB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" free.MB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" as Used_MB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("round"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("free.MB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" total.MB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" '"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("' as Used_Pct \nfrom "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\nselect tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" as MB \nfrom dba_free_space group by tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" free"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" as MB \nfrom dba_data_files group by tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" total     \nwhere free.tablespace_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" total.tablespace_name \norder by used_pct desc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("查看表空间总大小、使用率、剩余空间\nselect a.tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" total"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" free"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" total"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("free as used"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" substr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("free"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("total "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' as "FREE'),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" substr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),t._v("total "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" free"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("total "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' as "USED'),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v('"\nfrom\n'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" as total from dba_data_files group by tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" as free from dba_free_space group by tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" b\nwhere a.tablespace_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b.tablespace_name\norder by a.tablespace_name\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("查看表空间使用率"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("包含临时表空间"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nselect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" from "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\nSelect a.tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a.bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" b.bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' "表空间使用大小'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BYTE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\na.bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' "表空间大小'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nb.bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' "表空间剩余大小'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a.bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" b.bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' "表空间使用大小'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nto_char"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" b.bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("a.bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("'"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99.99999")]),t._v("'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" '"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v('\' "使用率"\nfrom '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes\nfrom dba_data_files\ngroup by tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes\nfrom dba_free_space\ngroup by tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" b\nwhere a.tablespace_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b.tablespace_name\nunion all\nselect c.tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('\nd.bytes_used "表空间使用大小'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BYTE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nc.bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' "表空间大小'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c.bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d.bytes_used"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' "表空间剩余大小'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nd.bytes_used"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(' "表空间使用大小'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v('"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nto_char"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d.bytes_used"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("c.bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("'"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99.99999")]),t._v("'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" '"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v('\' "使用率"\nfrom\n'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes\nfrom dba_temp_files group by tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes_cached"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes_used\nfrom v$temp_extent_pool group by tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" d\nwhere c.tablespace_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d.tablespace_name\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\norder by tablespace_name\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("查看具体表的占用空间大小\nselect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" from "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\nselect t.tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("t.owner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t.segment_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t.segment_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t.bytes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" mb\nfrom dba_segments t\nwhere t.segment_type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("'TABLE'\ngroup by t.tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("t.OWNER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t.segment_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t.segment_type\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" t\norder by t.mb desc\n\n\n扩展大小或增加表空间文\n更改表空间的dbf数据文件分配空间大小\nalter database datafile ‘...\\system_01.dbf' autoextend on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nalter database datafile ‘...\\system_01.dbf' resize "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v("M"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n为表空间新增一个数据文件"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("表空间满"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v("G不能扩展则增加表空间文件"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nalter tablespace SYSTEM add datafile '"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("' size "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("m autoextend on next "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n如果是temp临时表新增表空间会报错"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("RA"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("03217")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 变更TEMPORARY TABLESPACE 无效的选项\n解决方法"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" datafile改为tempfile\nalter tablespace TEMP01 add tempfile'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("' size "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("m autoextend on next "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("m maxsize "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("m\n\n针对temp临时表空间使用率爆满问题\n临时表空间主要用途是在数据库进行排序运算、管理索引、访问视图等操作时提供临时的运算空间，当运算完成之后系统会自动清理，但有些时候我们会遇到临时段没有被释放，TEMP表空间几乎满使用率情况；\n引起临时表空间增大主要使用在以下几种情况：\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("、order by or group by "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("disc sort占主要部分"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("；\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("、索引的创建和重创建；\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("、distinct操作；\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("、union "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" intersect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" minus sort"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("merge joins；\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("、Analyze 操作；\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("、有些异常也会引起TEMP的暴涨。\n解决方法一：用上述方法给temp增加表空间文件\n解决方法二：在服务器资源空间有限的情况下，重新建立新的临时表空间替换当前的表空间\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v("查看当前的数据库默认表空间：\nselect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" from database_properties\nwhere property_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("'DEFAULT_TEMP_TABLESPACE'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v("创建新的临时表空间\ncreate temporary tablespace TEMP01 tempfile \n'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("temp01.dbf' size "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),t._v("G"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v("更改默认临时表空间\nalter database default temporary tablespace TEMP01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.")]),t._v("删除原来的临时表空间\ndrop tablespace TEMP02 including contents and datafiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("如果删除原来临时表空间报错ORA"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60100")]),t._v("：由于排序段，已阻止删除表空间...\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("（说明有语句正在使用原来的临时表空间，需要将其kill掉再删除，此语句多为排序的语句）\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("查询语句\nSelect se.username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("se.sid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("se.serial#"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("su.extents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("su.blocks"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("to_number"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rtrim"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p.value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")])]),t._v("as Space,\ntablespace,segtype,sql_text\nfrom "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sort_usage")]),t._v(" su,v"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$parameter")]),t._v(" p,v"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session")]),t._v(" se,v"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sql")]),t._v(" s\nwhere "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("p.name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db_block_size'")]),t._v(" and "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("su.session_addr")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("se.saddr and "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("s.hash_value")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("su.sqlhash\nand "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("s.address")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("su.sqladdr\norder by se.username,se.sid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n--删除对应的"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sid,serial#'")]),t._v("\nalter system "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" session "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sid,serial#'")]),t._v("\n\n附：查看表空间是否具有自动扩展的能力\n--查看表空间是否具有自动扩展的能力     \nSELECT T.TABLESPACE_NAME,D.FILE_NAME,     \nD.AUTOEXTENSIBLE,D.BYTES,D.MAXBYTES,D.STATUS     \nFROM DBA_TABLESPACES T,DBA_DATA_FILES D     \nWHERE T.TABLESPACE_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("D.TABLESPACE_NAME     \n ORDER BY TABLESPACE_NAME,FILE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);