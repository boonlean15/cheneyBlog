(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{414:function(t,a,s){"use strict";s.r(a);var e=s(27),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"基于springboot-vue开发的web应用进行双向https部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于springboot-vue开发的web应用进行双向https部署"}},[t._v("#")]),t._v(" 基于SpringBoot+Vue开发的Web应用进行双向Https部署")]),t._v(" "),a("img",{attrs:{width:"600",src:"https://boonlean15.github.io/cheneyBlog/images/others/1.jpg",alt:"png"}}),t._v(" "),a("blockquote",[a("p",[t._v("客户端到Nginx采用双向Https访问，客户端选择数字证书进行登录，由Nginx配置双向Https认证，Nginx可以自动解析数字证书，并且我们可以拿到Nginx解析数字证书后的信息，获取到Nginx中的DN值后，放入请求头中，当Nginx反向代理请求Web应用时，就可以将数字证书中的用户信息数据DN传递给Web应用，应用拿到后就可以进行登录。")]),t._v(" "),a("blockquote",[a("p",[t._v("在此过程中，为了安全起见，Nginx到Web应用的请求采用的是单向Https。")])])]),t._v(" "),a("h2",{attrs:{id:"后端开启https示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端开启https示例"}},[t._v("#")]),t._v(" 后端开启https示例")]),t._v(" "),a("h3",{attrs:{id:"生成证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成证书"}},[t._v("#")]),t._v(" 生成证书")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("keytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genkey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" myhttps "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyalg")]),t._v(" RSA "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keysize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3068")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-validity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("36500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Users/myhttps.jks"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 然后输入密钥库口令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 再次输入新口令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输入名字姓氏那些，然后y确认生成证书")]),t._v("\n\nWarning:\nJKS 密钥库使用专用格式。建议使用 "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keytool -importkeystore -srckeystore /Users/myhttps.jks -destkeystore /Users/myhttps.jks -deststoretype pkcs12"')]),t._v(" 迁移到行业标准格式 PKCS12。\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行命令迁移到PKCS12")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srckeystore")]),t._v(" /Users/myhttps.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destkeystore")]),t._v(" /Users/myhttps.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deststoretype")]),t._v(" pkcs12\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JKS转换为P12")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srckeystore")]),t._v(" /Users/myhttps.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srcstoretype")]),t._v(" JKS "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deststoretype")]),t._v(" PKCS12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destkeystore")]),t._v(" /Users/myhttps.p12\n")])])]),a("h3",{attrs:{id:"springboot开启https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot开启https"}},[t._v("#")]),t._v(" springboot开启https")]),t._v(" "),a("blockquote",[a("p",[t._v("项目使用的PKCS12类型证书，步骤：使用示例创建证书、项目配置application.yml文件。")])]),t._v(" "),a("ul",[a("li",[t._v("在application.properties或者application.yml中进行配置")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9987")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("non-ssl-port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8089")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用于 非ssl请求 强制转成 ssl 请求")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当使用 访问地址：http://127.0.0.1:8089/hello 访问时 后台会 将请求 转换成 https://127.0.0.1:9987/hello")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  servlet:")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    context-path: /ssl-service")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ssl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key-store")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" classpath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("myhttps.p12  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#类路径下的自签证书")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key-alias")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myhttps "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 证书别名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key-store-password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myhttps "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#证书密码")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key-store-type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PKCS12 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 证书类型")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启证书验证")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("配置了如上属性后，默认开启了https，此时配置文件中的server.port配置的端口为https请求的端口")])]),t._v(" "),a("ul",[a("li",[t._v("springboot兼容http方式开启https")])]),t._v(" "),a("blockquote",[a("p",[t._v("以下可配置为http、https共同使用，实现思路是监听http请求转发到https请求")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bisp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("common"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("catalina"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("catalina"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Connector")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("descriptor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityCollection")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("descriptor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityConstraint")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("beans"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Value")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("embedded"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TomcatServletWebServerFactory")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("servlet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletWebServerFactory")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bean")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Configuration")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @ClassName TomcatConfig\n * @Description TODO\n * @Author yzx\n * @Date 2022/11/24 10:59\n **/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TomcatConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**获取配置端口*/")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${server.port}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" httpPort"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletWebServerFactory")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("servletContainer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TomcatServletWebServerFactory")]),t._v(" factory "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TomcatServletWebServerFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postProcessContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityConstraint")]),t._v(" constraint "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityConstraint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                constraint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUserConstraint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CONFIDENTIAL"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityCollection")]),t._v(" collection "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityCollection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                collection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addPattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                constraint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addCollection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("collection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addConstraint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("constraint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAdditionalTomcatConnectors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tomcatConnector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Connector")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tomcatConnector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Connector")]),t._v(" connector "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Connector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.apache.coyote.http11.Http11NioProtocol"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        connector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setScheme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//http端口号，可以自行指定（不能和其它已经使用的端口重复，否则会报错）")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置http的监听端口为80端口，这样访问的时候也可以不用带上端口号")]),t._v("\n        connector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        connector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSecure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//监听到的http的端口号后转向到https的端口号，可以自行指定")]),t._v("\n        connector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRedirectPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("httpPort"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" connector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"证书格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书格式"}},[t._v("#")]),t._v(" 证书格式")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v(".DER 扩展名\n用于二进制DER编码证书\n\n.PEM 扩展名\n用于不同类型的X.509v3文件，是以“ - BEGIN …”前缀的ASCII（Base64）数据\n\n.CRT 扩展名\nCRT扩展用于证书。 证书可以被编码为二进制DER或ASCII PEM。 CER和CRT扩展几乎是同义词。 最常见的于Unix 或类Unix系统\n\n.CER 扩展名\n.crt的替代形式\n\n.KEY 扩展名\n\nKEY扩展名用于公钥和私钥PKCS＃8。 键可以被编码为二进制DER或ASCII PEM\n")])])]),a("h3",{attrs:{id:"证书格式转换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书格式转换"}},[t._v("#")]),t._v(" 证书格式转换")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看PEM编码证书")]),t._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" cert.pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-text")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-noout")]),t._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" cert.cer "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-text")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-noout")]),t._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" cert.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-text")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-noout")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看DER编码证书")]),t._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" certificate.der "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-inform")]),t._v(" der "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-text")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-noout")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#转换证书格式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#转换可以将一种类型的编码证书存入另一种。（即PEM到DER转换）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PEM到DER")]),t._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" cert.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-outform")]),t._v(" der "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" cert.der\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#DER到PEM")]),t._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" cert.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-inform")]),t._v(" der "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-outform")]),t._v(" pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" cert.pem\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PEM -> DER -> JKS的转换(无私钥情况下转换pem格式证书为jks格式)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#pem文件 转换为 der文件")]),t._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-outform")]),t._v(" der "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" cert.pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" cert.der\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#der文件 转换为 jks文件")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" cert.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-file")]),t._v(" cert.der\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看证书信息")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-list")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v("  D:/demo.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storepass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("@store2\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JKS与P12相互转换")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JKS转换为P12")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srckeystore")]),t._v(" /Users/myhttps.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srcstoretype")]),t._v(" JKS "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deststoretype")]),t._v(" PKCS12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destkeystore")]),t._v(" /Users/myhttps.p12\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# P12转换为JKS")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srckeystore")]),t._v(" server.p12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srcstoretype")]),t._v(" PKCS12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deststoretype")]),t._v(" JKS "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destkeystore")]),t._v(" server.jks\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JKS与PEM转换")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JKS——>PEM")]),t._v("\nJSK转换为PEM需要先，JKS–"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("P12–"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("PEM\n//jks---"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("p12"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("需要注意这里必须add "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" keyOwnerAlias 否则会报错"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srckeystore")]),t._v(" sert.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destkeystore")]),t._v(" sert.p12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srcstoretype")]),t._v(" jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deststoretype")]),t._v(" pkcs12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" keyOwnerAlias\n//p12---"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("pem\nopenssl pkcs12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" sert.p12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" sert.pem\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# PEM——>JKS")]),t._v("\n//PEM---"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("PFX\nopenssl pkcs12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" test.pfx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-inkey")]),t._v(" test.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" test.pem\n//PFX---"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("JKS\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srckeystore")]),t._v(" test.pfx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destkeystore")]),t._v(" test.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srcstoretype")]),t._v(" PKCS12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deststoretype")]),t._v(" JKS\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# P12证书库导出CER")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" server "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" server.p12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storetype")]),t._v(" PKCS12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storepass")]),t._v(" huawei "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rfc")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-file")]),t._v(" huawei.cer\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 证书库JKS，添加为一个信任证书CER/PEM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 导出CER")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-file")]),t._v(" server.cer "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" client.jks\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 导出PEM")]),t._v("\nopenssl pkcs12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" server.p12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" server.pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nokeys")]),t._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看证书库")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-list")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" client.jks\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JKS—–>KEYSTORE")]),t._v("\n//JKS---"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("P12\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srckeystore")]),t._v(" D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test.keystore "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srcstoretype")]),t._v(" JKS "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deststoretype")]),t._v(" PKCS12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destkeystore")]),t._v(" test1.p12\n//P12----"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("KEYSTORE\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srckeystore")]),t._v(" D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test.p12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-srcstoretype")]),t._v(" PKCS12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destkeystore")]),t._v(" D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test.keystore "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deststoretype")]),t._v(" JKS\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# KEYSTORE——>JKS")]),t._v("\n//keystore---"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("crt\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-file")]),t._v(" D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test.keystore\n//CRT--"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("CER\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-inform")]),t._v(" pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" test.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-outform")]),t._v(" der "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" test.cer\n//CER---"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("JKS\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-file")]),t._v(" test.cer "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" test.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storepass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-noprompt")]),t._v(" \n")])])]),a("h3",{attrs:{id:"制作证书命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#制作证书命令"}},[t._v("#")]),t._v(" 制作证书命令")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("制作证书采用jdk自带keytool工具创建.示例1:")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("keytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genkey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" myhttps "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyalg")]),t._v(" RSA "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keysize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-validity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("36500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"D:/tmp/ssl/myhttps.keystore"')]),t._v("\n\n命令：keytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genkey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" testhttps "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyalg")]),t._v(" RSA "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keysize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-validity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("36500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"D:/tmp/ssl/testhttps.keystore"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 命令解释:")]),t._v("\n• "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genkey")]),t._v(" 表示要创建一个新的密钥。 \n\n• "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" 表示 keystore 的别名。 \n\n• "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyalg")]),t._v(" 表示使用的加密算法是 RSA。\n\n• "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keysize")]),t._v(" 表示密钥的长度．。\n\n• "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" 表示生成的密钥存放位直。 \n\n• "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-validity")]),t._v(" 表示密钥的有效时间，单位为天。\n")])])]),a("ul",[a("li",[a("strong",[t._v("制作证书，示例2:")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("keytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genkeypair")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" demo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keypass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("@key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyalg")]),t._v(" RSA "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keysize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-validity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("365")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" D:/demo.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storepass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("@store\n您的名字与姓氏是什么?\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":  lihz\n您的组织单位名称是什么?\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":  org\n您的组织名称是什么?\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":  org\n您所在的城市或区域名称是什么?\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":  wuhan\n您所在的省/市/自治区名称是什么?\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":  hubei\n该单位的双字母国家/地区代码是什么?\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":  CN\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("lihz, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("OU")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("org, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("O")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("org, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("L")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("wuhan, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("hubei, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("C")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("CN是否正确?\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("否"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":  y\nWarning:\nJKS 密钥库使用专用格式。建议使用 "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keytool -importkeystore -srckeystore D:/demo.jks -destkeystore D:/demo.jks -deststoretype pkcs12"')]),t._v(" 迁移到行业标准格式 PKCS12。\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("可以按照提示生成PKCS12格式证书")])])]),t._v(" "),a("ul",[a("li",[t._v("keytool参数")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("keytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-help")]),t._v("\n密钥和证书管理工具\n\n命令:\n\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-certreq")]),t._v("            生成证书请求\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-changealias")]),t._v("        更改条目的别名\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-delete")]),t._v("             删除条目\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-exportcert")]),t._v("         导出证书\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genkeypair")]),t._v("         生成密钥对\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genseckey")]),t._v("          生成密钥\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-gencert")]),t._v("            根据证书请求生成证书\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importcert")]),t._v("         导入证书或证书链\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importpass")]),t._v("         导入口令\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-importkeystore")]),t._v("     从其他密钥库导入一个或所有条目\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keypasswd")]),t._v("          更改条目的密钥口令\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-list")]),t._v("               列出密钥库中的条目\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-printcert")]),t._v("          打印证书内容\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-printcertreq")]),t._v("       打印证书请求的内容\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-printcrl")]),t._v("           打印 CRL 文件的内容\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storepasswd")]),t._v("        更改密钥库的存储口令\n\n\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genkeypair")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-help")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-genkeypair")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n生成密钥对\n\n选项:\n\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("alias"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                  要处理的条目的别名\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyalg")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("keyalg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                密钥算法名称\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keysize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("keysize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("              密钥位大小\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sigalg")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("sigalg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                签名算法名称\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-destalias")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("destalias"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("          目标别名\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-dname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("dname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                  唯一判别名\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-startdate")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("startdate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("          证书有效期开始日期/时间\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ext")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                    X.509 扩展\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-validity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("valDays"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("             有效天数\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keypass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("arg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                  密钥口令\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("keystore"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            密钥库名称\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storepass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("arg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                密钥库口令\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storetype")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("storetype"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("          密钥库类型\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-providername")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("providername"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    提供方名称\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-providerclass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("providerclass"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  提供方类名\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-providerarg")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("arg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("              提供方参数\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-providerpath")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pathlist"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        提供方类路径\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v("                              详细输出\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-protected")]),t._v("                      通过受保护的机制的口令\n")])])]),a("h3",{attrs:{id:"导出证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出证书"}},[t._v("#")]),t._v(" 导出证书")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#导出证书")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-alias")]),t._v(" demo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keystore")]),t._v(" D:/demo.jks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rfc")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-file")]),t._v(" D:/demo.cer "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-storepass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("@store\n存储在文件 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("D:/demo.cer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 中的证书\n\nWarning:\nJKS 密钥库使用专用格式。建议使用 "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keytool -importkeystore -srckeystore D:/demo.jks -destkeystore D:/demo.jks -deststoretype pkcs12"')]),t._v(" 迁移到行业标准格式 PKCS12。\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .cer 转换成 .crt  (方式1)")]),t._v("\nkeytool "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-printcert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rfc")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-file")]),t._v(" D:/demo.cer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" D:/demo.crt \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#可以使用openssl 工具转换，一般linux操作系统上都有，windows没有。")]),t._v("\nopenssl  x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-inform")]),t._v(" PEM "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" D:/demo.cer "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" D:/demo.crt \n")])])]),a("h3",{attrs:{id:"postman使用-如果需要使用postman则导出证书使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postman使用-如果需要使用postman则导出证书使用"}},[t._v("#")]),t._v(" Postman使用 - 如果需要使用postman则导出证书使用")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("Postman的证书\nPostman会对证书进行验证，只有正规机构颁发的证书才能验证通过，如果是自签的证书，则需要关闭验证 SSL certificate verification 。\n\nPostman增加客户端证书涉及3个文件和一个密码：\n\n.pfx 同时包含了公钥信息和私钥信息（cer只包含公钥信息）\n\n.cer 为客户端密钥库的公钥\n\n.key 为客户端密钥库的私钥\n\nPassphrase 为密钥库的密码。创建证书时设置的密码，-keypass 参数。\n")])])]),a("h2",{attrs:{id:"基于nginx实现双向https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于nginx实现双向https"}},[t._v("#")]),t._v(" 基于NGINX实现双向HTTPS")]),t._v(" "),a("blockquote",[a("p",[t._v("vue开启https方式存在问题，由于证书不能在本地主机上工作，所有证书只能在域名上工作。推荐使用nginx添加ssl")])]),t._v(" "),a("ul",[a("li",[t._v("制作证书")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("openssl genrsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-des3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" server.key "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("  创建服务器私钥\nGenerating RSA private key, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v(" bit long modulus "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" primes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".+++++\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".+++++\ne is "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65537")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x010001"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nEnter pass phrase "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" server.key:\nVerifying - Enter pass phrase "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" server.key:\n \nC:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("openssl req "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-key")]),t._v(" server.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" server.csr  创建CSR证书请求文件\nEnter pass phrase "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" server.key:\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.'")]),t._v(", the field will be left blank.\n-----\nCountry Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" letter code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":CN\nState or Province Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("full name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Some-State"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":Shanghai\nLocality Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":Shanghai\nOrganization Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, company"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Internet Widgits Pty Ltd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":XXXXX\nOrganizational Unit Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, section"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":Software\nCommon Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e.g. server FQDN or YOUR name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":YYYY\nEmail Address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":\n \nPlease enter the following "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'extra'")]),t._v(" attributes\nto be sent with your certificate request\nA challenge password "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":\nAn optional company name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":\n \nC:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("copy server.key server.key.orig  备份有秘密的私钥文件\n已复制         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" 个文件。\n \nC:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("openssl rsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" server.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" server.key  去掉私钥文件的密码\nEnter pass phrase "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" server.key:\nwriting RSA key\n \nC:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("nginx-1.16.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("openssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-req")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-days")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3650")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" server.csr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-signkey")]),t._v(" server.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" server.crt    使用服务器私钥签署服务器公钥证书\nSignature ok\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("subject")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("C "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CN, ST "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Shanghai, L "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Shanghai, O "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Intel, OU "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Software, CN "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" server1\nGetting Private key\n")])])]),a("ul",[a("li",[t._v("部署自签证书到nginx服务器")])]),t._v(" "),a("blockquote",[a("p",[t._v("Nginx的配置是最关键的，首先，需要将Vue生成的静态资源交给Nginx处理。其次，需要将Nginx配置成双向Https认证，客户端的证书交给Nginx认证并解析")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 二级路由跳转、接口代理、https信任自签证书")]),t._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        server_name localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听443端口, 开启ssl(必须)")]),t._v("\n        root /usr/share/nginx/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ssl")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 引用ssl证书(必须,如果放在nginx/conf/ssl下可以用相对路径,其他位置必须用绝对路径)")]),t._v("\n        ssl_certificate /etc/nginx/cert/server.crt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ssl_certificate_key /etc/nginx/cert/server.key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 协议优化(可选,优化https协议,增强安全性)")]),t._v("\n        ssl_session_cache  shared:SSL:10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ssl_session_timeout 10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ssl_protocols TLSv1.2 TLSv1.3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ssl_prefer_server_ciphers on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("NULL:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("aNULL:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("MD5:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ADH:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("RC4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n        gzip_buffers "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" 4K"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        gzip_comp_level "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#压缩级别，1-10，数字越大压缩的越好")]),t._v("\n        gzip_min_length "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不压缩临界值，大于100的才压缩，一般不用改")]),t._v("\n        gzip_types application/javascript text/css text/xml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        gzip_disable "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MSIE [1-6]\\."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# IE6对Gzip不友好，对Gzip")]),t._v("\n        gzip_vary on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        client_max_body_size  500m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                try_files "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ @router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                index  index.html index.htm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        location @router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                rewrite ^.*$ /index.html last"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当遇到/api （也就是我们的接口）对其进行反向代理")]),t._v("\n        location ~^/xxx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_set_header Upgrade "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_upgrade")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                proxy_set_header Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"upgrade"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                proxy_pass   https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${API_PATH}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        location ~^/cmp-xxx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_set_header Upgrade "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_upgrade")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                proxy_set_header Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"upgrade"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                proxy_pass   http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${MINIO_PATH}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("参考：\n"),a("a",{attrs:{href:"https://www.freesion.com/article/49521570591/",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于NGINX实现双向HTTPS部署并实现数字证书登录"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/lasding/p/16924679.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("自签名证书"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_41463944/article/details/131604251",target:"_blank",rel:"noopener noreferrer"}},[t._v("springboot开启https"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/demon7552003/article/details/125631771",target:"_blank",rel:"noopener noreferrer"}},[t._v("springboot使用https协议"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);